<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kidney Tumor Classification</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        padding: 40px 20px;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 40px;
        animation: slideDown 0.6s ease-out;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .main-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        animation: fadeIn 0.8s ease-out;
      }

      .image-section {
        padding: 40px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      }

      .result-section {
        padding: 40px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .image-container {
        width: 100%;
        max-width: 350px;
        height: 350px;
        border: 3px dashed #667eea;
        border-radius: 10px;
        margin: 0 auto 30px;
        overflow: hidden;
        background: white;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .image-container img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: none;
      }

      .image-container img.show {
        display: block;
      }

      .placeholder-text {
        color: #999;
        text-align: center;
        padding: 20px;
      }

      .button-group {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .btn-custom {
        padding: 12px 35px;
        font-size: 1rem;
        font-weight: 600;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .btn-upload {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-upload:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
      }

      .btn-predict {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
      }

      .btn-predict:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px rgba(245, 87, 108, 0.4);
      }

      .btn-predict:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      input[type="file"] {
        display: none;
      }

      .result-box {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        min-height: 250px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .result-badge {
        font-size: 2.5rem;
        font-weight: 700;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        animation: popIn 0.5s ease-out;
      }

      .result-badge.tumor {
        background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
        color: white;
      }

      .result-badge.normal {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        color: white;
      }

      #loading {
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        z-index: 9999;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      #loading.show {
        display: flex;
      }

      .loader {
        border: 8px solid #f3f3f3;
        border-top: 8px solid #667eea;
        border-radius: 50%;
        width: 70px;
        height: 70px;
        animation: spin 1s linear infinite;
      }

      .loading-text {
        color: white;
        font-size: 1.3rem;
        margin-top: 25px;
        font-weight: 500;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.5);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .info-box {
        background: #e3f2fd;
        border-left: 4px solid #667eea;
        padding: 15px;
        border-radius: 5px;
        margin-top: 20px;
        font-size: 0.95rem;
        color: #333;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.8rem;
        }

        .button-group {
          flex-direction: column;
        }

        .btn-custom {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1><i class="fas fa-heartbeat"></i> Kidney Tumor Classification</h1>
      <p>AI-powered medical imaging analysis</p>
    </div>

    <div class="main-container">
      <div class="row m-0">
        <div class="col-md-6 image-section">
          <h5 class="text-center mb-4">
            <i class="fas fa-image"></i> Upload CT Scan Image
          </h5>
          <div class="image-container" id="imageContainer">
            <div class="placeholder-text">
              <i
                class="fas fa-cloud-upload-alt"
                style="font-size: 3rem; color: #667eea"
              ></i>
              <p class="mt-3">Click "Choose Image" to upload</p>
            </div>
            <img id="photo" />
          </div>
          <div class="button-group">
            <label for="fileinput" class="btn-custom btn-upload mb-0">
              <i class="fas fa-cloud-upload-alt"></i> Choose Image
            </label>
            <input type="file" id="fileinput" accept="image/*" />
          </div>
          <div class="info-box">
            <strong><i class="fas fa-info-circle"></i> Tip:</strong> Upload a
            kidney CT scan image for AI analysis
          </div>
        </div>

        <div class="col-md-6 result-section">
          <h5 class="text-center mb-4">
            <i class="fas fa-chart-bar"></i> Prediction Result
          </h5>
          <div class="result-box" id="resultContainer">
            <p style="color: #999">
              <i class="fas fa-magic"></i><br /><br />Upload an image and click
              Predict to see results
            </p>
          </div>
          <div class="button-group">
            <button
              type="button"
              class="btn-custom btn-predict"
              id="predictBtn"
              disabled
            >
              <i class="fas fa-brain"></i> Predict
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="loading">
      <div class="loader"></div>
      <p class="loading-text">
        <i class="fas fa-cog fa-spin"></i> Analyzing image...
      </p>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      let base_data = "";

      function sendRequest(base64Data) {
        const url = "/predict";
        $("#loading").addClass("show");

        $.ajax({
          url: url,
          type: "POST",
          contentType: "application/json",
          data: JSON.stringify({ image: base64Data }),
          success: function (response) {
            $("#loading").removeClass("show");
            console.log("Response:", response);

            const prediction = response[0].image;
            const resultBox = $("#resultContainer");

            if (prediction.toLowerCase() === "tumor") {
              resultBox.html(`
                            <div>
                                <div class="result-badge tumor">
                                    <i class="fas fa-exclamation-triangle"></i><br>
                                    TUMOR DETECTED
                                </div>
                                <p style="color: #f5576c; font-weight: 600; font-size: 1.1rem;">
                                    A tumor has been detected in the scan.
                                </p>
                                <p style="color: #666; font-size: 0.95rem;">
                                    Please consult with a medical professional immediately.
                                </p>
                            </div>
                        `);
            } else {
              resultBox.html(`
                            <div>
                                <div class="result-badge normal">
                                    <i class="fas fa-check-circle"></i><br>
                                    NORMAL
                                </div>
                                <p style="color: #4facfe; font-weight: 600; font-size: 1.1rem;">
                                    No tumor detected.
                                </p>
                                <p style="color: #666; font-size: 0.95rem;">
                                    The scan appears to be normal.
                                </p>
                            </div>
                        `);
            }
          },
          error: function (xhr, status, error) {
            $("#loading").removeClass("show");
            console.error("Error:", error);
            console.error("Response:", xhr.responseText);

            $("#resultContainer").html(`
                        <div style="text-align: center;">
                            <i class="fas fa-times-circle" style="font-size: 3rem; color: #d32f2f;"></i>
                            <p style="color: #d32f2f; font-weight: 600; margin-top: 20px;">
                                Error processing image
                            </p>
                            <p style="color: #666; font-size: 0.9rem;">
                                ${xhr.responseText || "Please try again"}
                            </p>
                        </div>
                    `);
          },
        });
      }

      $(document).ready(function () {
        // Predict button click
        $("#predictBtn").click(function () {
          if (base_data) {
            sendRequest(base_data);
          } else {
            alert("Please upload an image first!");
          }
        });

        // File input change
        $("#fileinput").change(function () {
          if (this.files && this.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
              const img = new Image();
              img.crossOrigin = "Anonymous";

              img.onload = function () {
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                canvas.height = this.height;
                canvas.width = this.width;
                ctx.drawImage(this, 0, 0);

                base_data = canvas
                  .toDataURL("image/jpeg", 1.0)
                  .replace(/^data:image.+;base64,/, "");

                // Show image
                $("#photo").attr("src", e.target.result).addClass("show");
                $(".placeholder-text").hide();
                $("#predictBtn").prop("disabled", false);

                // Reset results
                $("#resultContainer").html(`
                                <p style="color: #999;">
                                    <i class="fas fa-magic"></i><br><br>
                                    Click "Predict" to analyze the image
                                </p>
                            `);
              };

              img.src = e.target.result;
            };

            reader.readAsDataURL(this.files[0]);
          }
        });
      });
    </script>
  </body>
</html>
